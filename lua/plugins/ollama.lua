-- lua/plugins/ollama.lua
-- Gen.nvim: Local AI Generation with Ollama
-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
-- â•‘                    ğŸ¤– LOCAL AI GENERATION (Ollama)                       â•‘
-- â•‘         Privacy-first AI that runs entirely on your machine              â•‘
-- â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
-- â•‘  ğŸ¯ SMART AI - Analyzes context before output!                           â•‘
-- â•‘                                                                           â•‘
-- â•‘  KEYMAPS (all start with <Space>aa):                                      â•‘
-- â•‘    <Space>aa      â†’ ğŸ¤– Open AI Menu                                      â•‘
-- â•‘    <Space>aac     â†’ ğŸ’¬ Chat                                              â•‘
-- â•‘    <Space>aam     â†’ ğŸ”„ Select Model                                      â•‘
-- â•‘    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
-- â•‘    CODE ACTIONS (select code first with V):                               â•‘
-- â•‘    <Space>aaz     â†’ ğŸ” Deep Analyze                                      â•‘
-- â•‘    <Space>aaf     â†’ ğŸ”§ Smart Fix                                         â•‘
-- â•‘    <Space>aae     â†’ âœ¨ Enhance                                           â•‘
-- â•‘    <Space>aao     â†’ âš¡ Optimize                                          â•‘
-- â•‘    <Space>aar     â†’ â™»ï¸ Refactor                                          â•‘
-- â•‘    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
-- â•‘    DOCUMENTATION:                                                         â•‘
-- â•‘    <Space>aad     â†’ ğŸ“ Generate Docs (ONLY doc block)                    â•‘
-- â•‘    <Space>aat     â†’ ğŸ§ª Generate Tests (preview)                          â•‘
-- â•‘    <Space>aaT     â†’ ğŸ§ª SMART TESTS â†’ auto creates test file!             â•‘
-- â•‘    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
-- â•‘    ANALYSIS (shows in floating window):                                   â•‘
-- â•‘    <Space>aav     â†’ ğŸ‘€ Code Review                                       â•‘
-- â•‘    <Space>aax     â†’ ğŸ’¡ Explain                                           â•‘
-- â•‘    <Space>aas     â†’ ğŸ“‹ Summarize                                         â•‘
-- â•‘    <Space>aaq     â†’ â“ Ask Question                                      â•‘
-- â•‘    <Space>aap     â†’ ğŸ›¡ï¸ Security Scan                                     â•‘
-- â•‘    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
-- â•‘    SMART INSERTION:                                                       â•‘
-- â•‘    <Space>aai     â†’ ğŸ§© Add Only Missing                                  â•‘
-- â•‘    <Space>aan     â†’ ğŸ†• Smart Insert                                      â•‘
-- â•‘    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
-- â•‘    JAVA SPECIFIC:                                                         â•‘
-- â•‘    <Space>aaj     â†’ â˜• Java Deep Dive                                    â•‘
-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

return {
  {
    'David-Kunz/gen.nvim',
    cmd = { 'Gen' },
    keys = {
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- MAIN MENU (Space + aa)
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aa', ':Gen<CR>', mode = { 'n', 'v' }, desc = 'ğŸ¤– AI Menu' },

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- QUICK ACTIONS (Normal Mode)
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aac', ':Gen Chat<CR>', desc = 'ğŸ’¬ Chat' },
      { '<leader>aam', function() require('gen').select_model() end, desc = 'ğŸ”„ Select Model' },

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- CODE TRANSFORMATION (Visual Mode - replaces selection)
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aaf', ':Gen Smart_Fix<CR>', mode = 'v', desc = 'ğŸ”§ Smart Fix' },
      { '<leader>aae', ':Gen Enhance_Code<CR>', mode = 'v', desc = 'âœ¨ Enhance' },
      { '<leader>aao', ':Gen Optimize<CR>', mode = 'v', desc = 'âš¡ Optimize' },
      { '<leader>aar', ':Gen Refactor<CR>', mode = 'v', desc = 'â™»ï¸ Refactor' },

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- SMART INSERTION (Context-aware)
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aai', ':Gen Add_Missing<CR>', mode = 'v', desc = 'ğŸ§© Add Only Missing' },
      { '<leader>aan', ':Gen Smart_Insert<CR>', mode = 'v', desc = 'ğŸ†• Smart Insert' },

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- DOCUMENTATION & TESTS
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aad', ':Gen Generate_Docs<CR>', mode = 'v', desc = 'ğŸ“ Generate Docs' },
      { '<leader>aat', ':Gen Generate_Tests<CR>', mode = 'v', desc = 'ğŸ§ª Generate Tests' },
      { '<leader>aaT', function() require('smart-test-gen').generate_and_write() end, mode = { 'n', 'v' }, desc = 'ğŸ§ª Tests â†’ File' },

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- ANALYSIS (Shows in floating window)
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aaz', ':Gen Deep_Analyze<CR>', mode = 'v', desc = 'ğŸ” Deep Analyze' },
      { '<leader>aav', ':Gen Code_Review<CR>', mode = 'v', desc = 'ğŸ‘€ Code Review' },
      { '<leader>aax', ':Gen Explain_Code<CR>', mode = 'v', desc = 'ğŸ’¡ Explain' },
      { '<leader>aas', ':Gen Summarize<CR>', mode = 'v', desc = 'ğŸ“‹ Summarize' },
      { '<leader>aaq', ':Gen Ask<CR>', mode = 'v', desc = 'â“ Ask Question' },
      { '<leader>aap', ':Gen Security_Scan<CR>', mode = 'v', desc = 'ğŸ›¡ï¸ Security' },

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- JAVA SPECIFIC
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      { '<leader>aaj', ':Gen Java_Deep_Dive<CR>', mode = 'v', desc = 'â˜• Java Deep' },
    },

    opts = {
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- OLLAMA CONFIGURATION
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      model = 'gemma3:270m',
      host = 'localhost',
      port = '11434',

      -- Clean Display
      display_mode = 'float',
      show_prompt = false,
      show_model = true,
      no_auto_close = false,
      debug = false,

      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- SMART PROMPTS - Context-aware, deep analysis before output
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      prompts = require('config.gen_prompts'),
    },

    config = function(_, opts)
      require('gen').setup(opts)

      -- Which-key integration
      local ok, wk = pcall(require, 'which-key')
      if ok then
        wk.add({
          { '<leader>aa', group = 'ğŸ¤– AI (Ollama)', icon = { icon = 'ó°š©', color = 'green' } },
        })
      end

      -- Startup notification
      vim.defer_fn(function()
        local notify_ok, notify = pcall(require, 'notify')
        if notify_ok then
          notify([[
ğŸ¤– AI Ready! (gemma3:270m)

Press <Space>aa for AI Menu

Quick Actions:
  <Space>aac â†’ Chat
  <Space>aaf â†’ Smart Fix
  <Space>aai â†’ Add Missing]], 'info', { title = 'Gen.nvim', timeout = 3000 })
        end
      end, 500)
    end,
  },
}
